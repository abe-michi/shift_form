<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ガントチャート式シフト表</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="shift_gantt.css" rel="stylesheet">
  <style>
    .time-cell {
      width: 60px;
      position: relative;
      padding: 0;
    }
    .bar-container {
      position: relative;
      height: 32px;
    }
    .bar {
      position: absolute;
      height: 20px;
      top: 6px;
      border-radius: 4px;
      color: #fff;
      font-size: 11px;
      text-align: center;
      white-space: nowrap;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 4px;
    }
    .bar:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      top: -26px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: #fff;
      padding: 4px 6px;
      border-radius: 4px;
      font-size: 11px;
      white-space: nowrap;
      z-index: 10;
    }
  </style>
</head>
<body>
  <h2 style="font-size: 1.2rem;">2025年7月 ガントチャート式シフト表</h2>
  <div class="mb-2">
    表示日：
    <select id="dateSelect" class="form-select d-inline-block w-auto">
      <option value="7/1">7/1</option>
      <option value="7/2">7/2</option>
    </select>
  </div>
  <div class="mb-2">
    <span class="legend-box" style="background:#007bff;"></span> 田中　
    <span class="legend-box" style="background:#28a745;"></span> 山田　
    <span class="legend-box" style="background:#dc3545;"></span> 伊藤　
    <span class="legend-box" style="background:#ffc107;"></span> 中村　
    <span class="legend-box" style="background:#17a2b8;"></span> 加藤　
    <span class="legend-box" style="background:#888;"></span> その他（未設定）
  </div>
  <div class="gantt-wrapper">
    <table class="gantt-table">
      <thead>
        <tr>
          <th class="sticky fixed-col">氏名</th>
          <th class="sticky fixed-col-2">開始</th>
          <th class="sticky fixed-col-3">終了</th><th class="sticky time-cell">10:00</th><th class="sticky time-cell">11:00</th><th class="sticky time-cell">12:00</th><th class="sticky time-cell">13:00</th><th class="sticky time-cell">14:00</th><th class="sticky time-cell">15:00</th><th class="sticky time-cell">16:00</th><th class="sticky time-cell">17:00</th><th class="sticky time-cell">18:00</th><th class="sticky time-cell">19:00</th><th class="sticky time-cell">20:00</th><th class="sticky time-cell">21:00</th><th class="sticky time-cell">22:00</th><th class="sticky time-cell">23:00</th><th class="sticky time-cell">24:00</th><th class="sticky time-cell">25:00</th><th class="sticky time-cell">26:00</th></tr>
      </thead>
      <tbody id="ganttBody"></tbody>
    </table>
  </div>
  <script>
    const shiftData = [
      { id: "001", name: "佐藤", date: "7/1", start: "10:00", end: "18:00", color: "" },
      { id: "002", name: "田中", date: "7/1", start: "13:00", end: "20:00", color: "#007bff" },
      { id: "003", name: "鈴木", date: "7/1", start: "14:00", end: "22:00", color: "" },
      { id: "004", name: "山田", date: "7/1", start: "15:00", end: "23:00", color: "#28a745" },
      { id: "006", name: "伊藤", date: "7/1", start: "09:00", end: "17:00", color: "#dc3545" },
      { id: "001", name: "佐藤", date: "7/2", start: "13:00", end: "17:00", color: "" },
      { id: "002", name: "田中", date: "7/2", start: "11:00", end: "19:00", color: "#007bff" },
      { id: "003", name: "鈴木", date: "7/2", start: "10:00", end: "14:00", color: "" },
      { id: "004", name: "山田", date: "7/2", start: "15:00", end: "22:00", color: "#28a745" },
      { id: "005", name: "高橋", date: "7/2", start: "12:00", end: "18:00", color: "" },
      { id: "006", name: "伊藤", date: "7/2", start: "10:30", end: "15:30", color: "#dc3545" },
      { id: "007", name: "渡辺", date: "7/2", start: "16:00", end: "24:00", color: "" },
      { id: "008", name: "中村", date: "7/2", start: "17:00", end: "26:00", color: "#ffc107" },
      { id: "009", name: "小林", date: "7/2", start: "11:30", end: "16:00", color: "" },
      { id: "010", name: "加藤", date: "7/2", start: "13:00", end: "20:00", color: "#17a2b8" }
    ];
    const baseTime = 10 * 60;
    const scale = 60;
    const ganttBody = document.getElementById("ganttBody");
    const dateSelect = document.getElementById("dateSelect");

    function toMinutes(str) {
      const [h, m] = str.split(":").map(Number);
      return h * 60 + m;
    }

    function render(date) {
      ganttBody.innerHTML = "";
      const data = shiftData.filter(s => s.date === date);
      data.sort((a, b) => a.id.localeCompare(b.id) || toMinutes(a.start) - toMinutes(b.start));

      for (const item of data) {
        const tr = document.createElement("tr");
        const tdName = document.createElement("td");
        tdName.textContent = item.name;
        tdName.className = "fixed-col";
        const tdStart = document.createElement("td");
        tdStart.textContent = item.start;
        tdStart.className = "fixed-col-2";
        const tdEnd = document.createElement("td");
        tdEnd.textContent = item.end;
        tdEnd.className = "fixed-col-3";
        tr.appendChild(tdName);
        tr.appendChild(tdStart);
        tr.appendChild(tdEnd);

        const startMin = toMinutes(item.start);
        const endMin = toMinutes(item.end);
        const startHour = Math.floor((startMin - baseTime) / 60);
        const endHour = Math.ceil((endMin - baseTime) / 60);

        for (let h = 0; h < 17; h++) {
          const td = document.createElement("td");
          td.className = "time-cell";
          const container = document.createElement("div");
          container.className = "bar-container";
          if (h >= startHour && h < endHour) {
            const bar = document.createElement("div");
            const startOffset = h === startHour ? (startMin - baseTime - startHour * 60) : 0;
            const endOffset = h === endHour - 1 ? (60 - (endMin - baseTime - (endHour - 1) * 60)) : 0;
            bar.style.left = startOffset + "px";
            bar.style.width = (60 - startOffset - endOffset) + "px";
            bar.className = "bar";
            bar.style.backgroundColor = item.color || "#888";
            bar.textContent = item.name;
            bar.setAttribute("data-tooltip", `${item.name}：${item.start}〜${item.end}`);
            container.appendChild(bar);
          }
          td.appendChild(container);
          tr.appendChild(td);
        }
        ganttBody.appendChild(tr);
      }
    }

    dateSelect.addEventListener("change", e => render(e.target.value));
    render(dateSelect.value);
  </script>
</body>
</html>
